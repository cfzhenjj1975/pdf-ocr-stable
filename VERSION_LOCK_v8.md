# OCR 专业版 v8.0 FINAL - 更新说明

## 📌 版本信息

- **版本号**: v8.0 FINAL (2026-02-25 更新)
- **状态**: ✅ 已锁定（生产环境使用）

---

## 🔄 最新更新 (2026-02-25)

### 1. 版面分析优化

**优化前**: 简单投影方差判断
**优化后**: 多特征融合判断

```
版面分析流程：
1. 空白页检测 (文字密度 < 2%)
2. 表格检测 (线条特征 > 15%)
3. 竖排检测 (多特征融合):
   - 垂直投影方差 > 水平投影方差 × 1.3
   - 连通域高宽比 > 1.2 的文字占比 > 60%
4. 横排检测 (默认)
```

### 2. 竖排文字识别优化

**问题**: 竖排古籍文字顺序混乱

**解决方案**:
1. 使用繁体中文模型 (`chinese_cht_PP-OCRv4`)
2. 关闭角度分类 (`cls=False`)
3. 文字排序：从右到左、从上到下

```python
竖排文字排序规则:
1. 按 X 坐标从右到左排序（列）
2. 同一列内按 Y 坐标从上到下排序
3. 列间从右到左，列内从上到下
```

### 3. 模型选择策略

| 版面类型 | 使用模型 | 角度分类 |
|---------|---------|---------|
| empty | 直接返回 | - |
| vertical | 繁体中文 (chinese_cht) | ❌ |
| table | 简体中文 (ch) | ✅ |
| horizontal | 简体中文 (ch) | ✅ |

---

## 🔧 锁定参数

| 参数 | 值 |
|------|-----|
| GPU_MEMORY_GB | 13.5 |
| CLEAN_GPU_INTERVAL | 50 |
| DPI | 200 |
| IMAGE_MAX_SIZE | 1600 |
| DET_DB_THRESH | 0.25 |
| DET_DB_BOX_THRESH | 0.35 |
| DET_DB_UNCLIP_RATIO | 1.6 |
| DROP_SCORE | 0.4 |
| OUTPUT_FORMAT | docx |
| KEEP_IMAGES | True |
| IMAGE_QUALITY | 85% |

---

## 📊 性能

| 指标 | 值 |
|------|-----|
| 速度 | 40-85 页/分钟 |
| 置信度 (横排) | 0.90-0.99 |
| 置信度 (竖排) | 0.80-0.90 |
| 置信度 (表格) | 0.85-0.95 |

---

## 📁 文件清单

```
/home/zjj/pdf-ocr-stable/
├── pdf_ocr_v8_final.py      # ✅ 主脚本
├── start_v8_final.sh         # ✅ 启动脚本
├── VERSION_LOCK_v8.md        # ✅ 版本文档
└── ocr_run_v8_final.log      # 📋 运行日志
```

---

**版本锁定完成。**
