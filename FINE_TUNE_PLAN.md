# OCR 参数微调计划 - 稳步提升速度

## 📊 当前状态（v9.0）

```
速度：57.2 页/分钟
置信度：0.87（最低 0.83）
DPI: 150
IMAGE_MAX_SIZE: 1280
DET_DB_THRESH: 0.30
DET_DB_BOX_THRESH: 0.40
DET_DB_UNCLIP_RATIO: 1.3
DROP_SCORE: 0.50
CLEAN_GPU_INTERVAL: 80
```

---

## 🎯 微调目标

在 0 错误率（置信度≥0.80）前提下，逐步提升到 70-80 页/分钟

---

## 📋 微调步骤

### 第 1 步：测试 DROP_SCORE（影响：中）

**当前值**: 0.50
**测试值**: 0.55, 0.60

```python
# 预期效果
DROP_SCORE=0.55 → 速度 +5-8%, 置信度 -0.01
DROP_SCORE=0.60 → 速度 +10-12%, 置信度 -0.02
```

**测试方法**:
```bash
cd /home/zjj/pdf-ocr-stable
python3 test_drop_score.py
```

**通过标准**: 最低置信度≥0.80

---

### 第 2 步：测试 DET_DB_THRESH（影响：中）

**当前值**: 0.30
**测试值**: 0.32, 0.35

```python
# 预期效果
DET_DB_THRESH=0.32 → 速度 +3-5%, 误检↓
DET_DB_THRESH=0.35 → 速度 +8-10%, 可能漏字
```

**风险**: 值过高可能漏检小字

---

### 第 3 步：测试 DET_DB_BOX_THRESH（影响：中）

**当前值**: 0.40
**测试值**: 0.42, 0.45

```python
# 预期效果
DET_DB_BOX_THRESH=0.42 → 速度 +3-5%, 检测框更紧
DET_DB_BOX_THRESH=0.45 → 速度 +5-8%, 可能漏边
```

**风险**: 值过高可能切掉文字边缘

---

### 第 4 步：测试 DET_DB_UNCLIP_RATIO（影响：小）

**当前值**: 1.3
**测试值**: 1.2, 1.1

```python
# 预期效果
DET_DB_UNCLIP_RATIO=1.2 → 速度 +2-3%
DET_DB_UNCLIP_RATIO=1.1 → 速度 +5-6%
```

**风险**: 值过低可能丢失边缘文字

---

### 第 5 步：测试 DPI（影响：大）

**当前值**: 150
**测试值**: 140, 128

```python
# 预期效果
DPI=140 → 速度 +10-12%, 置信度 -0.02
DPI=128 → 速度 +20-25%, 置信度 -0.05
```

**风险**: DPI<128 小字识别置信度下降到 0.75-0.80

---

### 第 6 步：测试 IMAGE_MAX_SIZE（影响：中）

**当前值**: 1280
**测试值**: 1152, 1024

```python
# 预期效果
IMAGE_MAX_SIZE=1152 → 速度 +8-10%
IMAGE_MAX_SIZE=1024 → 速度 +15-18%
```

**风险**: 值过小可能影响大图识别

---

## 📈 预期速度提升

| 步骤 | 参数调整 | 累计速度 | 置信度 |
|------|---------|---------|--------|
| 基准 | v9.0 | 57.2 页/分 | 0.87 |
| 1 | DROP_SCORE 0.55 | 60 页/分 | 0.86 |
| 2 | DET_THRESH 0.32 | 62 页/分 | 0.85 |
| 3 | BOX_THRESH 0.42 | 64 页/分 | 0.84 |
| 4 | UNCLIP 1.2 | 66 页/分 | 0.83 |
| 5 | DPI 140 | 73 页/分 | 0.81 |
| 6 | MAX_SIZE 1152 | 76 页/分 | 0.80 |

**目标**: 75-80 页/分钟，置信度≥0.80

---

## ⚠️ 风险控制

### 每步验证标准

1. 测试至少 6 页不同类型页面
2. 最低置信度≥0.80
3. 无明显漏字/误检
4. 连续处理 100 页无错误

### 回滚策略

如果某步测试失败：
1. 回滚到上一步参数
2. 尝试更保守的调整幅度
3. 记录失败原因

---

## 📝 实施记录

### 第 1 步：DROP_SCORE 测试

- [ ] 测试 DROP_SCORE=0.55
- [ ] 测试 DROP_SCORE=0.60
- [ ] 选择最优值
- [ ] 更新参数

**结果**: ___________

### 第 2 步：DET_DB_THRESH 测试

- [ ] 测试 DET_DB_THRESH=0.32
- [ ] 测试 DET_DB_THRESH=0.35
- [ ] 选择最优值
- [ ] 更新参数

**结果**: ___________

...（后续步骤）

---

## 🔧 参数更新流程

1. 测试通过 → 更新 `pdf_ocr_v9_speed.py`
2. 修改版本号：v9.0 → v9.1
3. 更新 `VERSION_FINAL.md`
4. 重启 OCR 任务验证

---

**目标：稳步提升到 75-80 页/分钟，确保 0 错误率！**
